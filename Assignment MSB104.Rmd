---
title: "Econometrics assignment"
author: "Heidi Marie Rolfsnes and Ann Elisabeth Jacobsen"
output:
  html_document: default
  pdf_document: default
---

```{r Packages}
#| echo = FALSE
suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))
suppressMessages(library(tibble))
suppressMessages(library(readr))
suppressMessages(library(knitr))
suppressMessages(library(dplyr))
suppressMessages(library(dineq))
suppressMessages(library(magrittr))
suppressMessages(library(vtable))
suppressMessages(library(wooldridge))
suppressMessages(library(huxtable))
suppressMessages(library(lmtest))
options(scipen = 999)
knitr::opts_chunk$set(echo = TRUE, include = TRUE)
```
# Assignment 1
In the subject MSB104 econometrics, this year we will hand in an assignment divided into four assignments throughout the semester. The assignments must be written and calculated in the software R. We are group one and the countries that will be representing in our assignment is: Denmark, France, Hungary, Portugal and Slovakia.

In this assignment we downloaded two dataset from Eurostat. The data contains GDP (nama_10r_3gdp) and population (demo_r_pjanaggr3,pi) for countries over the last 20 years, on a NUTS3 level. 
When we have all the information we need from the dataset, we are going to calculate the GDP per capita and describe the data by using the meta data description from Eurostat. 

In the second part of this assignment we will use our data to calculate the population watertight GDP Ginie coefficients for the European NUTS2 (j) level and describe our new data. Then we are going to plot the distribution of Ginie coefficients
In the end of the first assignment we will discuss if there are noteworthy outliers.

There are different types of GDP values and the unit is stored in a column named "UNIT", we have chosen to use values where unit is MIO_EUR. This unit represents the GDP value in million Euros.

```{r Dataset GDP and rename obs_value, time_period and geo}
#| echo = FALSE
BNP <- read.csv("Dataset/nama_10r_3gdp.csv")
BNP <- BNP %>%
  select(geo, TIME_PERIOD, OBS_VALUE, unit) %>%
      rename(GDP = "OBS_VALUE",Year = "TIME_PERIOD", Region = "geo") 

Pop <- read.csv("Dataset/Population.csv")
Pop <- Pop %>%
    select(geo, TIME_PERIOD, OBS_VALUE) %>%
      rename(Population = "OBS_VALUE",Year = "TIME_PERIOD", Region = "geo") 
```

We made a new dataset called gdppop. In this dataset we will gather the information we need from the other two datasets and combine them into one dataset. This will do it easier in our ongoing research.  

```{r Make one datset with GDP and Population}
#| echo = FALSE
gdppop <- BNP %>%
  left_join(Pop, by = c("Region", "Year"))
```

```{r}
#| echo = FALSE
gdppop %>%
  vtable::st()
```

## GDP per Capita 

To calculate GDP per capita, we took GDP and divided it by the population. And then we have multiplied by one million, so that it is represented correctly in Euros.

```{r Calculate GDP per capita}
#| echo = FALSE
gdppop <- gdppop  %>%
mutate(gdp_per_capita =   GDP/Population*1000000) %>%
na.omit()
#NA variables are removed
```


Briefly about what we found in the summary. We found the min and the max values. i.e. the smallest and the highest GDP per capita for the country. We also found 1st quartile and 3rd quartile. The first quartile was the observation between the median and the lowest value, and looks at the 25% lowest values from the 75% highest. The median looks at the value that is observed the most times in the middle of the observations. The third quartile is then, naturally enough, the value between the median and the highest value.We have also look at mean which told us what the average observation for all regions was.

And then we further look at GDP, population and GDP per capita in our five countries and what results it gives us when we calculate all the NUTS3 regions together.
```{r}
#| echo = FALSE
gdppop %>%
filter(unit == "MIO_EUR" & (grepl('DK..', Region) | grepl('FR..', Region) | grepl('HU..', Region)| grepl('PT..', Region) | grepl('SK..', Region))) %>% 	summarise( GDP_per_Capita = mean(gdp_per_capita)) 
```

From the summary we can see that GDP per capita at NUTS3 level for all our countries was 22 438,88 Euro. Since we don't have any other values to compare with we can't say to much about it, because it doesn´t give us to much information. We will therefor look at the nuts3 regions for each country. 


```{r}
#| echo = FALSE
summary(gdppop)
```

It wasn't easy to draw any conclusion from the summary above. We can see that there is a difference in GDP as the lowest value is 683,7 while the highest is 251 623,6. We can also see that the maximum value is high compared to the other values, as the 3rd quartile is only 18 416,7. Population and gdp_ per_capita gave us the same results, with a very low minimum and a high maximum value. 

To get a better picture of the different countries and the opportunity to see if there are regions that stand out. We make summaries per country, because then we have the opportunity to exclude regions that stand out in futher assignments. We will also look at a spesific year for all the country to compare results with.

To get the result by country, we made a summary of GDP per capita on each country. By creating such a summary for each country, we can get an overview of whether there are major inequality within the various regions. If we find such deviations, we can choose to remove some of our regions in order not to have large inequalities.

Since Hungary and Slovakia have few nuts3 regions we chose to look at them together. 


### Denmark
  
```{r GDP in Denmark}
#| echo = FALSE
gdppop%>%
     filter(grepl("DK...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in Denmark', x = "Year", y = "GDP Per capita") 
```
Denmark is a small country in Scandinavia,and they don't have many NUTS3 regions. Kobenhagen is the capital of Denmark, and as we can see above it stand out together with the surrounding region. we can se that the region around the capital has had a higher growth. Capital cities are often richer than other regions. we can see that in Denmark as well. 

To get an overview, we have chosen to look at 2010 for all the regions in Denmark to see which regions are the richest and least wealties.

The whealtiest regions in Denmark
```{r the whealtiest regions in Denmark}
#| echo = FALSE
gdpdk <- gdppop%>%
  filter(grepl("DK...", Region)) %>%
  filter(Year==2010) %>%
  select(Year, Region, gdp_per_capita)
slice_max(gdpdk, gdp_per_capita, n=3)
```
The poorest regions in Denmark
```{r The poorest regions in Denmark}
#| echo = FALSE
slice_min(gdpdk, gdp_per_capita, n=3)

```

```{r}
#| echo = FALSE
gdpdk %>%
summary()
```
The three Whealties regions in Denmark are Kobenhagen (DK011), Kobenhagen area (DK012) and Sydjylland (DK032).
The three least wealtiest regions in Denmark are Vest- og Sydjælland (DK022), Bornholm (DK014) and Østsjælland (DK021).

Denmark has 11 nuts3 regions, it is the capital and the surrounding region that stands out among the richest, in the poor countries it is more even, we can see that there is 30,000 Euro between the richest and poorest.

### France

```{r GDP in France}
#| echo = FALSE
gdppop%>%
     filter(grepl("FR...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in France', x = "Year", y = "GDP Per capita")
```

```{r}
#| echo = FALSE
gdppop%>%
  filter(grepl("FR...", Region)) %>%
  select(Population, gdp_per_capita) %>%
  summary()
```
France is a country in Western Europe, they also have colonies in other parts of the world. France has the largest land areas in the EU, which we see in the fact that they have over a hundred nuts3 regions.

Since France has so many nuts3 regions, it is not so easy to distinguish the different regions. We see that here too the capital Paris stands out. When we made a summary, we see that there is a difference in min and max. When we look more closely at the numbers, we can see that this may be due to France having colonies in other countries that are included. These colonies are located in Africa and South America which has a negative effect on France's overall GDP. For further research, we have chosen to remove these regions from the data set.

```{r Take away the FRY regions}
#| echo = FALSE
gdppop <- gdppop %>%
  filter(Region != 'FRY10') %>%
   filter(Region != 'FRY20') %>%
   filter(Region != 'FRY30') %>%
   filter(Region != 'FRY40') %>%
   filter(Region != 'FRY50') 
```

```{r France without the FRY regions}
#| echo = FALSE
gdppop%>%
     filter(grepl("FR...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in France', x = "Year", y = "GDP Per capita")
```
The whealtiest regions in France
```{r The whealtiest regions in France}
#| echo = FALSE
gdpfr <- gdppop %>%
  filter(grepl("FR...", Region)) %>%
  filter(Year==2010) %>%
  select(Year, Region, gdp_per_capita)
slice_max(gdpfr, gdp_per_capita, n=3)
```

The poorest regions in France
```{r The poorest regions in France}
#| echo = FALSE
slice_min(gdpfr, gdp_per_capita, n=3)
```

```{r}
#| echo = FALSE
summary(gdpfr)
```

France now have 96 nuts3 regions. The three wealtiest regions are Paris (FR101), Hauts-de-seine (FR105) and Rhône (FRK26). Paris og Hauts-de-seine stands out clarly from the other region with a difference of approximately 50,000 Euro GDP pr capita.
The three poorest regions Creuse (FRI22), Ariège (FRJ21) and  Meuse(FRF32). These regions have quite the same GDP pr capita. 

### Hungary and Slovakia

```{r GDP in Hungary and Slovakia}
#| echo = FALSE
gdppop %>%
     filter (grepl('HU..', Region) | grepl('SK..', Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in Hungary and Slovakia ', x = "Year", y = "GDP Per capita")
```
Hungary and Slovakia are both countries in Central Europe, here we see that the capitals Bratislava and Budapest both had great growth until 2008. Then Budabest went down a little while Bratislava had a larger increase. the rest of the regions have had an more steady growth.

The whealtiest regions in Hungary and Slovakia
```{r The whealtiest regions in Hungary and Slovakia}
#| echo = FALSE
gdphusk <- gdppop%>%
filter(grepl('HU..', Region) | grepl('SK..', Region)) %>%
  filter(Year==2010) %>%
  select(Year, Region, gdp_per_capita)
slice_max(gdphusk, gdp_per_capita, n=3)
```
The poorest regions in Hungary and Slovakia
```{r The poorest regions in Hungary and Slovakia}
#| echo = FALSE
slice_min(gdphusk, gdp_per_capita, n=3)
```

```{r}
#| echo = FALSE
gdphusk %>%
summary()
```

Hungary and Slovakia has 28 regions together. The tre whelties are Bratislava (SK010), Budapest (HU110) and Trnava (SK021). The capitals of both countries have the richest region. The least wheltiest regions are Nògràd(HU313), Szabolcs-Szatmàr-Bereg(HU323). We can see that the three poorest regions belong to Hungary. which means that they have a lower GDP per capita than Slovakia in the poorest regions. We see that there is a difference between min and max in the regions of Hungary. 

There is a difference of approximately 25,000 Euro between the whelties and poorest regions in Hungary. Based on these observations, Bratislava is the richest region, since we do not see any of Slovakia's regions among the lowest, we can assume that Slovakia has a higher GDP per capita than Hungary has for its inhabitants.

### Portugal

```{r GDP in Portugal}
#| echo = FALSE
gdppop%>%
     filter(grepl("PT...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in Portugal', x = "Year", y = "GDP Per capita") 
```

Portugal is a country in southern Europe. Portugal also has two archipelagos, each representing a different region.
We see steady growth in all the regions, all have had a slight decline between 2010-2012, after that there has been an increase. We also see that in Portugal the capital Lisbon stands out as the richest region.

The whealtiest regions in Portugal
```{r the whealtiest regions in Portugal}
#| echo = FALSE
gdppt <- gdppop%>%
  filter(grepl("PT...", Region)) %>%
  filter(Year==2010) %>%
  select(Region, gdp_per_capita)
slice_max(gdppt, gdp_per_capita, n=3)
```
The poorest regions in Portugal
```{r The poorest regions in Portugal}
#| echo = FALSE
slice_min(gdppt, gdp_per_capita, n=3)
```

```{r}
#| echo = FALSE
gdppt %>%
summary()
```

Portugal has 25 regions. The wheltiest are Lisboa(PT170), Alentejo Litoral (PT181) and Algarve (PT150). We can se that Lisboa has a litle higher GDP pr capita then the rest of the wheltiest regions. The poorest regions are Tãmega e Sousa (PT11C), Alto Tãmega (PT11B) and Beiras e Serra da Estrela (PT16J). There is approximatly 14,000 Euro in GDP per capita, in difference between the wealties and the poorest regions.     

In all the countries, we see that it is the capitals that stand out the most and have the highest GDP per capita among their inhabitants. Paris has managed to have the highest GDP per capita and the poorest regions can be found in Hungary.
 

## Descriptive Statistics regional inequity (Gini Nuts2) and discuss briefly if there are noteworthy outliers

Furthermore, we will use the data to calculate population waterproof GDP Ginie coefficients for our countries at a NUTS2 () level. 

A Gini coefficient must be between 0 and 1. If it's 0, it means that there is little inequality, and if it's closer to 1, it means that there is a greater degree of inequality between rich and poor. We calculate a Gini coefficient by looking at how much wealth and income there is in a country and then how it is distributed among the population.
when we have calculated the gini coefficients, we will also run a test on the data we have to see if we find outliers. Outliers are values that are either very high or very low compared to the other data we have.

### Gini for all countries all years  

```{r Gini for all countries }
#| echo = FALSE
#Nuts 2 id
gdppop %<>%  
  mutate(nuts2 = substr(Region,1,4)) 
#Nuts 1 id
gdppop %<>%  
  mutate(nuts0 = substr(Region,1,2))
#gen weighted gini
#for all
gini.wtd(gdppop$gdp_per_capita, w = gdppop$Population)

gdppop <- gdppop %<>% 
   group_by(nuts2, Year) %>%
  mutate(gini_n2= gini.wtd(gdp_per_capita, w = Population)) %>%
  ungroup() # to remove grouping

gdppop  %>% 
  #| echo = FALSE
  filter(Year == 2010) %>% 
   distinct(nuts2, Year,.keep_all = TRUE) %>%
select(gini_n2) %>%
st()
```


First, we look at all the regions in the selected countries. We have 46 observations. The total Gini for all countries for all years is 0.28. This Gini is for all 5 countries over the last 20 years. We think that it will be a bit "washed away" and will therefore look at each individual country. 
We can also see that we have ginis that are 0 which means a perfect correlation. We will look at each country to find out why and where there are regions that have ginis that are 0. To look more specifically at the countries, we have chosen to only look at the year 2010.

```{r NUTS2 in Denmark}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "DK") %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in Denmark', x = "Year", y = "Gini")
```

```{r}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "DK") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```
Outliers in Denmark
```{r Outliers in Denmark}
#| echo = FALSE
dkoutliers <- gdppop %>%
  filter(nuts0 == "DK") %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
dkoutliers
```

In the graph above, you can see that there are two regions that have varied quite a bit over the past 20 years. They still stay below 0.025, which shows that there is little difference between rich and poor in these regions. Another region that stands out is DK01. It is a bit further up the graph than the other regions. Although it is not close to 0, there is a greater difference between rich and poor here than in the other regions.

In Denmark, the Gini coefficients are between 0 and 0,11. Denmark has a region Nordjylland (DK05) which is an outlier. In this region, no data has been recorded in 2010.  Denmark has only five NUTS2 regions, which doesn't gives us much data to work with.

### France

```{r NUTS2 in France}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "FR") %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in France', x = "Year", y = "Gini") 

```

```{r}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "FR") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

Outliers in France
```{r Outliers in France}
#| echo = FALSE
froutliers <- gdppop %>%
  filter(nuts0 == "FR") %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
froutliers
```

In France, there are so many regions that it is difficult to see the regions properly in the graph above. What is shown well is that the vast majority of regions follow each other evenly by being below 0.1. There are still some that stand out and we can see that FR10 is the highest with a gini of 0.3, while FRJ1 and FRK1 fluctuate quite a bit from 2005 to 2020

In France, the Gini coefficients are between 0,02 and 0,26, which shows us that France has a slightly higher gini than Denmark, which means that the inequality is slightly greater in France.France doesn´t have any outliers, after we took away the FRY regions, 


### Hungary and Slovakia


```{r NUTS2 in Hungary and Slovakia}
#| echo = FALSE
gdppop %>%
filter(grepl('HU..', Region) | grepl('SK..', Region)) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in Hungary and Slovakia', x = "Year", y = "Gini")

```

```{r}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "HU") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

```{r}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "SK") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```
Outliers in Hungary and Slovakia
```{r Outliers in Hungary and Slovakia}
#| echo = FALSE
huskoutliers <- gdppop %>%
   filter (grepl('HU..', Region) | grepl('SK..', Region)) %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
huskoutliers
```

Hungary and Slovakia have large fluctuations in their regions. One of the regions with the most fluctuations is HU22 where we can see that they are down to a gini of 0.075 in 2012, while in 2016 they are up to a gini of approximately 0.12. Hungary and Slovakia are small countries in Eastern Europe and we assume that this is the reason why there are large fluctuations.

In Hungary, the Gini coefficient are between 0 and 0,08. Hungary has two regions which are outliers Budapest (HU11) and Pest (HU12). Pest and Budapest hasn't had any data for the periode that we are looking into.   

In Slovakia,the Gini coefficient are also between 0 and 0,08. Slovakia has on region that is an outliers which are (SK01). It leaves only Slovakia with three regions from which we obtain data. 

### Portugal

```{r NUTS2 in Portugal}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "PT") %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in Portugal', x = "Year", y = "Gini")

```

```{r}
#| echo = FALSE
gdppop %>%
filter(nuts0 == "PT") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```
Outliers in Portugal
```{r Outliers in Portugal}
#| echo = FALSE
ptoutliers <- gdppop %>%
  filter(nuts0 == "PT") %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
ptoutliers
```
In the graph for Portugal, we can see that the Gini in several of the regions has been declining over the past 20 years. That is to say, the differences between rich and poor have narrowed over the years. PT18 stands out somewhat in that there are strong fluctuations over the years.

In Portugal, the Gini coefficient are between 0 and 0,08. Portugal has four regions, Algarve (PT15) Lisboa(PT17), Regiäo Autònoma dos Acores (PT20) and Regiäo Autònoma da Madeira (PT30). Regiäo Autònoma dos Acores and Regiäo Autònoma da Madeira are both archipelagos belonging to Portugal which may be the reason why they are outliers. Portugal doesn't have many NUTS 2 regions, and when four of them have no value, there is not much confidence in the result we get.


### Discuss briefly if there are noteworthy outliers

To summarize what has been done in assignment 1, we have calculated GDP per capita for all the countries combined and per country we have been given. We saw that when we collected all the countries we got 22,805.13 Euros in GDP per capita. Denmark had a significantly higher GDP per capita than the other countries. Hungary had the lowest with only 8781.69. France has colonies in other continents, we chose to remove these regions, this so that GDP would not be affected by these regions that belong to others continents.

When we look at outliers for our countries, we can not find any outliers in France, but we do find in all the other countries. All the regions that are outliners are regions that have only one province, in Hungary, Slovakia and Portugal (HU11, HU12, SK01, PT15 and PT 17) the outliers are linked to the capitals. Capitals are often large areas, which only have one region. Portugal also has two island groups (PT20 and PT30) that come up as outliers, these are small regions. The last region that has outliners can be found in Denmark (DK05), this is a small region.

# Assignment 2 
At the second assigment we are looking at growth and inequity. We are going to estimate the effect if regional development on regional inequality, for the year 2010. Then we will disuse the goodness of fit of our estimated model.
We will plot the relationship between regional development and regional inequality and the fitted line corresponding to our estimate. We are also going to plot the residuals against the predicted values of our model.
There will be a discussion about the classical assumptions OLS in light of our data and plots and other determinants of inequity.

We will also go back on Eurostat´s webpages and  download EurostatLinks to an external site. It will be for our subset of countries regional (NUTS2, j) data related to transport infrastructure, education and demographics. We are suppose to select on variable per category that we would like to explore further in there relationship to regional inequality.
We will try to estimate a multiple linear regression model with our new variables for 2010 and give a small interpretation of our findings.
In the end we will discuss the overall fit of our model and the inference related to our findings.

### Data set: 

We want to look at the amount of people who have higher education in the education data set and how many motorways there is in kilometers when we look in the transport dataset. In the demographic data set we want to look at the life expectancy age.

```{r Data set Education }
#| echo = FALSE
Education <- read_csv('Dataset/education.csv',show_col_types = FALSE )
Education <- Education %>%
  select(unit,isced11,geo,age,TIME_PERIOD,OBS_VALUE) %>%
  filter(unit=="PC" & isced11=="ED0-2" & age=="Y25-64" & (grepl('DK..', geo) | grepl('FR..', geo) | grepl('HU..', geo)| grepl('PT..', geo) | grepl('SK..', geo))) %>%
  mutate(Edu = OBS_VALUE, Year=TIME_PERIOD, nuts2=geo) %>%
  select(nuts2, Year, Edu)
```

```{r Data set Motorways}
#| echo = FALSE
Transport <- read_csv('Dataset/transport.csv',show_col_types = FALSE )%>%
  mutate(Road=OBS_VALUE, Year=TIME_PERIOD, nuts2=geo) %>%
  select(nuts2, Year, Road)
```

```{r Data set life expectancy age }
#| echo = FALSE
Lifeexp <- read_csv('Dataset/Life.csv' ,show_col_types = FALSE) %>%
mutate(lea = OBS_VALUE, Year = TIME_PERIOD, nuts2=geo) %>%
  select(nuts2, Year, lea)
```

```{r}
#| echo = FALSE
gdppop2010 <- gdppop %>%
  mutate(nuts2 = substr(Region,1,4))%>%
  group_by(nuts2, Year) %>%
  mutate(Gini = gini.wtd(gdp_per_capita, w = Population),
         gdp_n3 = sum(GDP, na.rm=T),
         pop_n3 = sum(Population, na.rm=T)) %>%
  mutate(gdp_n2 = sum(gdp_n3),pop_n2 = sum(pop_n3))%>%
  ungroup() %>%
  #Keeping only 1 obs per NUTS 2
    distinct(Year, nuts2,Gini,gdp_n2,pop_n2) %>%
  mutate(gdp_per_capita = gdp_n2/pop_n2*1000000)
```


## Growth and inequity

Further in the thesis, we will look at growth and inequity in the regions at Nuts2 level. We will look at the development in the regions in relation to the economy. if there is great inequality in the world, rich countries will become richer and poor countries will become poorer. which will create an underclass, where people will have less education and poorer living conditions.


```{r New variables}
#| echo = FALSE
gdppop2010 <- gdppop2010 %>%
left_join(Education, by = c("Year", "nuts2" ))%>%
left_join(Lifeexp, by = c("nuts2", "Year"))%>%
left_join(Transport, by = c("nuts2", "Year"))%>%
  #economic development = (gdp_per_capita)
  mutate(nuts0 = substr(nuts2,1,2)) %>%
filter(Year == 2010)
```

```{r}
gdppop2010 %>%
  st(.)
```

## Estimate the effete of regional development on regional inequality GINI for the year 2010


```{r}
ggplot()+
  geom_point(data = gdppop2010, mapping = aes(x = gdp_per_capita, y = Gini))
#for alle land
```

```{r}


```



```{r
reg <- lm(gdp_n2 ~ lea + gdp_per_capita + Edu, data = gdppop2010)
coeftest(reg,  )
```

```{r
reg2 <- lm(log(gdp_n2) ~ log(lea) + log(gdp_per_capita) + log(Edu), data = gdppop2010)
coefficients(reg,vcov=hccm )
```



```{r}
#| echo = FALSE
gdppop2010 <- gdppop2010%>%
  filter(Gini > 0)
Denmark2010 <- gdppop2010 %>%
  filter(nuts0=="DK") 
France2010 <- gdppop2010 %>%
  filter(nuts0=="FR")
HungarySlovakia2010 <- gdppop2010 %>%
 filter(grepl('HU..', nuts2) | grepl('SK..', nuts2))
Portugal2010 <- gdppop2010 %>%
  filter(nuts0=="PT")
```


```{r lm all}
lm.1 = lm(Gini ~ gdp_per_capita, data = Denmark2010)
lm.2 = lm(Gini ~ gdp_per_capita, data = France2010)
lm.3 = lm(Gini ~ gdp_per_capita, data = HungarySlovakia2010)
lm.4 = lm(Gini ~ gdp_per_capita, data = Portugal2010)
lm.5 = lm(Gini ~ gdp_per_capita, data = gdppop2010)

#Gen Table
  huxreg(
  list("Denmark" = lm.1, "France" = lm.2, "Hungary_Slovakia" = lm.3, "Portugal" = lm.4, "Total" = lm.5),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(gdp_per_capita = "gdp_per_capita", const. = "(Intercept)"),
  note = "Note: {stars} T statistics in brackets."
  )
```


***AE - How do we find the cofficients? ***
```{r}
#Save coefficients
b1_total <- lm.5$coefficients[1]
b2_total <- lm.5$coefficients[2]

```

```{r}
ggplot() +
  xlim(0, 15) +
  ylim(-0.3, 0.5) +
  geom_point(aes(x = gdp_per_capita, y = Gini)) +
  geom_abline(intercept = b1_total, slope = b2_total)

```


next... 


```{r
BNP2010 %>%
  filter(Year==2010 & nuts0=="DK") %>%
ggplot(aes(x =edu, y=Gini, fill=id_nuts2, color=id_nuts2)) +
  geom_point(lwd = .8) +
   labs(x = "Education", y = "Gini")



```{r
multi_linear_regression_model_1 <- function(mlrdata){
lm.1 = lm(Gini ~ edu , mlrdata) 
lm.2 = lm(Gini ~  Road, mlrdata)
lm.3 = lm(Gini ~ edu + Road, mlrdata)
lm.4 = lm(Gini ~  lea, mlrdata)
lm.5 = lm(Gini ~ edu + Lea, mlrdata)
#Gen Table
  huxreg(
  list("Model 1" = lm.1, "Model 2" = lm.2, "Model 3" = lm.3,"Model 4" = lm.4,"Model 5" = lm.5),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(Education = "edu","Road", Lifeexp = "lifeexpectancyage", const. = "(Intercept)"),
  note = "Note: {stars} T statistics in brackets."
  )
}
```


